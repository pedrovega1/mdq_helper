#!/usr/bin/env node

/**
 * ğŸ” Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹
 * 
 * Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
 *   node generate-hash.js
 * 
 * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚:
 *   1. Ğ¥ĞµÑˆ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ´Ğ»Ñ ADMIN_PASSWORD_HASH
 *   2. Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ JWT_SECRET
 */

const bcrypt = require('bcrypt');
const crypto = require('crypto');
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
console.log('ğŸ” Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ñ… Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¸ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²');
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');

rl.question('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²): ', async (password) => {
    if (!password || password.length < 8) {
        console.error('\nâŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²');
        rl.close();
        process.exit(1);
    }

    try {
        console.log('\nâ³ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ…ĞµÑˆĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (ÑÑ‚Ğ¾ Ğ·Ğ°Ğ¹Ğ¼Ñ‘Ñ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞºÑƒĞ½Ğ´)...\n');
        
        // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ…ĞµÑˆĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (10 Ñ€Ğ°ÑƒĞ½Ğ´Ğ¾Ğ² - Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸)
        const saltRounds = 10;
        const hash = await bcrypt.hash(password, saltRounds);
        
        // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğ³Ğ¾ JWT ÑĞµĞºÑ€ĞµÑ‚Ğ° (256 Ğ±Ğ¸Ñ‚)
        const jwtSecret = crypto.randomBytes(32).toString('hex');
        
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');
        
        console.log('ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ÑÑ‚Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ² Ñ„Ğ°Ğ¹Ğ» .env:\n');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log(`ADMIN_PASSWORD_HASH=${hash}`);
        console.log(`JWT_SECRET=${jwtSecret}`);
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');
        
        console.log('âš ï¸  Ğ’ĞĞ–ĞĞ:');
        console.log('   1. Ğ£Ğ´Ğ°Ğ»Ğ¸ ÑÑ‚Ğ°Ñ€ÑƒÑ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ API_KEY Ğ¸Ğ· .env');
        console.log('   2. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑÑ‚Ğ¸ Ğ´Ğ²Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ');
        console.log('   3. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€: node server/server.js');
        console.log('   4. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ\n');
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ…ĞµÑˆĞ°
        const isValid = await bcrypt.compare(password, hash);
        if (isValid) {
            console.log('âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ…ĞµÑˆĞ°: Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾\n');
        } else {
            console.log('âŒ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ…ĞµÑˆĞ°: ĞÑˆĞ¸Ğ±ĞºĞ° (ÑÑ‚Ğ¾ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ñ‚Ğ¸)\n');
        }
        
    } catch (error) {
        console.error('\nâŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸:', error.message);
        process.exit(1);
    } finally {
        rl.close();
    }
});

rl.on('close', () => {
    console.log('\nğŸ‘‹ Ğ”Ğ¾ ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ!\n');
    process.exit(0);
});
